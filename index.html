<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Mixer Kreatif (Standalone)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use Inter font and apply base styles -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Base styles for the HTML structure */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
    <!-- React, ReactDOM, and Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel allows in-browser JSX compilation. Note: This is slower and only for development/standalone demos -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root">
        <!-- Loading indicator until React mounts -->
        <div class="flex justify-center items-center min-h-screen bg-gray-100 text-indigo-700 text-xl font-semibold">
            Memuat Aplikasi Prompt Mixer...
        </div>
    </div>

    <script type="text/babel">
        // Catatan: Dalam file ini, React, useState, dan useEffect tersedia secara global.
        const { useState, useEffect } = React;

        // --- KONSTANTA & DATA (DIAMBIL DARI PROMPTSMIXER.JSX) ---

        const API_KEY = ""; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

        const HISTORY_STORAGE_KEY = 'GEMINI_PROMPT_HISTORY';
        const HISTORY_LIMIT = 10;
        const AD_GRACE_PERIOD_MS = 60 * 1000; // Iklan aktif kembali setelah 60 detik
        const AD_LAST_SHOWN_KEY = 'AD_LAST_SHOWN_TIMESTAMP';

        const PROMPT_CATEGORIES = [
            { key: 'image', label: 'Prompt Gambar (Image / Art)' },
            { key: 'video', label: 'Prompt Video (Video / Animasi)' },
            { key: 'code', label: 'Prompt Kode (Code / Logic)' },
            { key: 'text', label: 'Prompt Teks (Essay / Story)' },
        ];

        const OUTPUT_LANGUAGES = [
            { key: 'id', label: 'Indonesia' },
            { key: 'en', label: 'English' },
        ];

        const DETAIL_LEVELS = [
            { key: 'minimal', label: 'Minimal (1 Kalimat Ringkas)' },
            { key: 'standard', label: 'Standar (1 Paragraf Kohesif)' },
            { key: 'maximal', label: 'Maksimal (2 Paragraf/Checklist Detail)' },
        ];

        const PREDEFINED_STYLES = [
            { key: 'cinematic', label: 'Sinematik', categories: ['image', 'video'] },
            { key: '8k', label: 'Ultra Detailed 8K', categories: ['image', 'video'] },
            { key: 'pixel', label: 'Pixel Art', categories: ['image'] },
            { key: 'anime', label: 'Gaya Anime/Manga', categories: ['image'] },
            { key: 'van-gogh', label: 'Gaya Van Gogh (Lukisan Minyak)', categories: ['image'] },
            { key: 'clean-code', label: 'Kode Modular & Bersih', categories: ['code'] },
            { key: 'performance', label: 'Dioptimalkan untuk Kinerja (Performance)', categories: ['code'] },
            { key: 'security', label: 'Fokus Keamanan (Security)', categories: ['code'] },
            { key: 'epic', label: 'Epik, Fantasi', categories: ['image', 'video', 'text'] },
            { key: 'academic', label: 'Gaya Akademik/Formal', categories: ['text'] },
            { key: 'journalistic', label: 'Gaya Jurnalistik', categories: ['text'] },
            { key: 'minimalist', label: 'Minimalis', categories: ['image', 'text'] },
        ];

        const EXAMPLE_SEEDS = {
            image: [
                "Prajurit Samurai dengan helm futuristik",
                "Bertarung di hutan bambu neon saat badai",
                "Gaya seni digital, sinematik, lighting dramatis",
            ],
            video: [
                "Transisi cepat dari kota kuno ke kota modern",
                "Pergerakan kamera mengikuti sebuah mobil balap melintasi jembatan",
                "Adegan ini harus memiliki soundtrack yang intens dan epik",
            ],
            code: [
                "Buat fungsi Python untuk memvalidasi alamat email",
                "Gunakan regex modern dan kembalikan boolean",
                "Tuliskan juga unit test dasar untuk fungsi tersebut",
            ],
            text: [
                "Cerita pendek tentang AI yang menemukan keindahan alam",
                "Menggunakan sudut pandang orang pertama yang penuh refleksi",
                "Tone melankolis namun penuh harapan",
            ],
        };

        const RANDOM_SEEDS = [
            'Kucing ruang angkasa', 'Piramida terbalik', 'Lampu neon berkabut', 'Kota bawah laut', 
            'Robot tua berkarat', 'Pohon kristal raksasa', 'Air Terjun Beku', 'Jalanan pasar malam di Tokyo',
            'Sepeda motor terbang', 'Dunia fantasi pasca-apokaliptik', 'Naga bersayap baja', 'Jam saku kuno',
            'Gaya seni Van Gogh', 'Fotografi makro', 'Sinematik 8K', 'Gaya ilustrasi buku anak-anak',
            'Minimalis', 'Pop Art', 'Realistis', 'Ukiyo-e Jepang', 'Lukisan minyak', 'Low Poly',
            'Melayang di udara', 'Mencari artefak kuno', 'Malam yang sepi', 'Penuh kegembiraan dan ledakan',
            'Sedang bertransmisi data', 'Pahlawan tanpa ekspresi', 'Menatap bintang jatuh', 'Kekuatan super',
            'Berlari melalui dimensi', 'Kejutan tak terduga', 'Momen hening sebelum badai',
            'Algoritma rekursif', 'Menggunakan API eksternal', 'Struktur data graf', 'Sistem otentikasi biometrik',
            'Memproses data JSON yang besar', 'Optimasi kinerja (performance optimization)',
        ];

        // --- LOGIKA HELPER ---

        const getInitialHistory = () => {
            try {
                const history = localStorage.getItem(HISTORY_STORAGE_KEY);
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error("Could not load history from local storage", e);
                return [];
            }
        };

        const getRandomSeed = () => {
            const index = Math.floor(Math.random() * RANDOM_SEEDS.length);
            return RANDOM_SEEDS[index];
        };

        const getSystemPrompt = (selectedCategory, langKey, detailLevel, visualWeight, technicalWeight) => {
            const langInstruction = langKey === 'en' ? 'English' : langKey === 'jp' ? 'Japanese' : 'Indonesia';
            let contentInstruction = "";
            let lengthInstruction = "";

            switch (detailLevel) {
                case 'minimal':
                    lengthInstruction = "Output harus SANGAT SINGKAT, maksimal satu kalimat fokus pada elemen kunci.";
                    break;
                case 'maximal':
                    lengthInstruction = selectedCategory === 'code' || selectedCategory === 'video' 
                        ? "Output harus detail, berupa 2-3 paragraf atau daftar periksa teknis (checklist) yang komprehensif."
                        : "Output harus berupa 2-3 paragraf naratif yang sangat deskriptif dan imersif.";
                    break;
                case 'standard':
                default:
                    lengthInstruction = "Output harus berupa satu paragraf lengkap dan kohesif.";
                    break;
            }

            switch (selectedCategory) {
                case 'image':
                    contentInstruction = "Fokus pada komposisi, pencahayaan, tekstur, gaya artistik, dan detail visual yang kuat (misalnya, resolusi 8K, cinematic lighting) untuk menghasilkan karya seni berkualitas tinggi.";
                    break;
                case 'video':
                    contentInstruction = "Fokus pada elemen temporal: gerakan kamera (misalnya, dolly shot, slow zoom), transisi adegan, suasana, dan potensi desain suara. Output harus mencakup narasi visual adegan yang detail.";
                    break;
                case 'code':
                    contentInstruction = "Fokus pada mendefinisikan bahasa pemrograman, fungsionalitas utama yang harus dicapai, struktur data yang diperlukan, dan batasan kinerja/desain.";
                    break;
                case 'text':
                    contentInstruction = "Fokus pada pengembangan karakter/argumen, konflik, sudut pandang (POV), dan genre/nada tulisan.";
                    break;
                default:
                    contentInstruction = "Tambahkan detail artistik, seperti pencahayaan, tekstur, gaya, komposisi, dan kedalaman bidang yang relevan.";
                    break;
            }

            return `
                Anda adalah Insinyur Prompt AI yang kreatif dan ahli dalam menghasilkan deskripsi skenario yang kaya dan detail, disesuaikan untuk kebutuhan ${selectedCategory}. 
                Tugas Anda adalah mengambil tiga konsep/frasa yang disediakan pengguna beserta BOBOT prioritasnya (skala 1-10) dan menggabungkannya menjadi satu prompt yang sangat deskriptif, kohesif, dan menginspirasi. 
                Pastikan untuk mengembangkan dan memberikan detail visual/teknis LEBIH BANYAK pada konsep yang memiliki bobot LEBIH TINGGI.
                
                PERHATIAN KHUSUS UNTUK PROMPT LANJUTAN/SUFFIX: 
                Bobot Visual Global: ${visualWeight}/10. Jika ada gaya visual (seperti 8K, Anime, atau Van Gogh), gunakan bobot ini untuk menentukan prioritas estetika tersebut.
                Bobot Teknis Global: ${technicalWeight}/10. Jika ada parameter teknis (seperti --ar 16:9, Python 3.10), gunakan bobot ini untuk menentukan prioritas implementasi teknis tersebut.
                
                ${contentInstruction}
                ${lengthInstruction}
                Output harus dalam Bahasa ${langInstruction}.
            `;
        };

        const getCategoryDescription = (selectedCategory) => {
            switch (selectedCategory) {
                case 'image':
                    return "Dioptimalkan untuk komposisi, pencahayaan, dan gaya artistik visual.";
                case 'video':
                    return "Dioptimalkan untuk pergerakan kamera, transisi, dan alur sinematik.";
                case 'code':
                    return "Dioptimalkan untuk spesifikasi fungsi, bahasa pemrograman, dan struktur data.";
                case 'text':
                    return "Dioptimalkan untuk narasi, sudut pandang, konflik, dan genre tulisan.";
                default:
                    return "AI akan menggabungkan ide Anda dengan fokus pada detail kreatif umum.";
            }
        };

        const fetchWithRetry = async (url, options, retries = 3) => {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error("API request failed after multiple retries.");
                    }
                }
            }
        };

        // --- KOMPONEN UTAMA ---
        const App = () => {
            const [seeds, setSeeds] = useState({ 
                seedA: '', seedB: '', seedC: '',
                weightA: 5, weightB: 5, weightC: 5,
            });
            
            const [category, setCategory] = useState(PROMPT_CATEGORIES[0].key); 
            const [outputLanguage, setOutputLanguage] = useState(OUTPUT_LANGUAGES[0].key);
            const [detailLevel, setDetailLevel] = useState(DETAIL_LEVELS[1].key); 
            const [selectedStyles, setSelectedStyles] = useState([]); 
            const [advancedSuffix, setAdvancedSuffix] = useState('');
            const [isCopied, setIsCopied] = useState(false);
            
            const [generatedPrompt, setGeneratedPrompt] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const [isAdBlockActive, setIsAdBlockActive] = useState(false);
            const [isAdLoading, setIsAdLoading] = useState(false); 
            const [countdown, setCountdown] = useState(0); 

            const [visualWeight, setVisualWeight] = useState(5);
            const [technicalWeight, setTechnicalWeight] = useState(5);

            const [promptHistory, setPromptHistory] = useState(getInitialHistory);

            // --- LOGIKA IKLAN ---
            
            const checkAdStatus = () => {
                const lastShown = localStorage.getItem(AD_LAST_SHOWN_KEY);
                const now = Date.now();
                
                if (!lastShown) {
                    setIsAdBlockActive(true);
                    setCountdown(0);
                } else {
                    const lastShownTime = parseInt(lastShown, 10);
                    const elapsed = now - lastShownTime;
                    const remaining = AD_GRACE_PERIOD_MS - elapsed;

                    if (remaining <= 0) {
                        setIsAdBlockActive(true);
                        setCountdown(0);
                    } else {
                        setIsAdBlockActive(false);
                        setCountdown(Math.ceil(remaining / 1000));
                    }
                }
            };
            
            const handleAdInteraction = async () => {
                if (isAdLoading || isLoading) return;

                setIsAdLoading(true);
                setError(null);
                setGeneratedPrompt('');

                const messageBox = document.getElementById('message-box');
                messageBox.textContent = `Iklan sedang tayang (3 detik). Anda akan mendapatkan grace period ${AD_GRACE_PERIOD_MS / 1000} detik setelah ini.`;
                messageBox.classList.remove('hidden');

                await new Promise(resolve => setTimeout(resolve, 3000));
                
                localStorage.setItem(AD_LAST_SHOWN_KEY, Date.now().toString());
                setIsAdBlockActive(false);
                setIsAdLoading(false);
                messageBox.classList.add('hidden');
                
                handleMix();
            };

            useEffect(() => {
                checkAdStatus();
                const intervalId = setInterval(checkAdStatus, 1000); 
                return () => clearInterval(intervalId);
            }, []); 

            const availableStyles = PREDEFINED_STYLES.filter(style => style.categories.includes(category));

            useEffect(() => {
                const currentStyleKeys = availableStyles.map(s => s.key);
                setSelectedStyles(prev => prev.filter(styleKey => currentStyleKeys.includes(styleKey)));
            }, [category]);
            
            // --- LOGIKA RIWAYAT & SALIN ---

            const savePromptToHistory = (prompt) => {
                const categoryLabel = PROMPT_CATEGORIES.find(c => c.key === category)?.label || category;
                const langLabel = OUTPUT_LANGUAGES.find(l => l.key === outputLanguage)?.label || outputLanguage;

                const newItem = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit', day: '2-digit', month: '2-digit' }),
                    prompt: prompt,
                    category: categoryLabel,
                    language: langLabel,
                };
                
                setPromptHistory(prevHistory => {
                    const newHistory = [newItem, ...prevHistory].slice(0, HISTORY_LIMIT);
                    try {
                        localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(newHistory));
                    } catch (e) {
                        console.error("Could not save history to local storage", e);
                    }
                    return newHistory;
                });
            };

            const deleteHistoryItem = (id) => {
                setPromptHistory(prevHistory => {
                    const newHistory = prevHistory.filter(item => item.id !== id);
                    try {
                        localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(newHistory));
                    } catch (e) {
                         console.error("Could not update history after deletion", e);
                    }
                    return newHistory;
                });
            };
            
            const copyToClipboard = (textToCopy) => {
                const textarea = document.createElement('textarea');
                const finalContent = textToCopy || generatedPrompt; 
                
                if (!finalContent) return;

                textarea.value = finalContent;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000); 
                    return true;
                } catch (err) {
                    console.error('Gagal menyalin:', err);
                    const messageBox = document.getElementById('message-box');
                    messageBox.textContent = "Gagal menyalin. Silakan salin teks secara manual.";
                    messageBox.classList.remove('hidden');
                    setTimeout(() => messageBox.classList.add('hidden'), 3000);
                    return false;
                } finally {
                    document.body.removeChild(textarea);
                }
            };
            
            // --- LOGIKA UTAMA APLIKASI ---

            const handleSeedChange = (name, value) => {
                setSeeds(prev => ({ ...prev, [name]: value }));
            };
            
            const handleWeightChange = (name, value) => {
                const parsedValue = parseInt(value, 10);
                setSeeds(prev => ({ ...prev, [name]: Math.min(10, Math.max(1, parsedValue)) }));
            };
            
            const handleGlobalWeightChange = (setter, value) => {
                const parsedValue = parseInt(value, 10);
                setter(Math.min(10, Math.max(1, parsedValue)));
            };

            const handleRandomWeights = () => {
                if (buttonDisabled) return;
                const randomWeight = () => Math.floor(Math.random() * 10) + 1; // 1 to 10
                setSeeds(prev => ({
                    ...prev,
                    weightA: randomWeight(),
                    weightB: randomWeight(),
                    weightC: randomWeight(),
                }));
            };

            const toggleStyle = (styleKey) => {
                setSelectedStyles(prev => {
                    if (prev.includes(styleKey)) {
                        return prev.filter(key => key !== styleKey);
                    } else {
                        return [...prev, styleKey];
                    }
                });
            };

            const handleFillExamples = () => {
                const seedsToFill = EXAMPLE_SEEDS[category] || EXAMPLE_SEEDS.image;
                setSeeds(prev => ({ 
                    ...prev,
                    seedA: seedsToFill[0], 
                    seedB: seedsToFill[1], 
                    seedC: seedsToFill[2] 
                }));
            };
            
            const handleRandomSeed = (seedName) => {
                if (!isLoading && !isAdLoading) {
                    setSeeds(prev => ({ ...prev, [seedName]: getRandomSeed() }));
                }
            };

            const handleMix = async () => {
                const { seedA, seedB, seedC, weightA, weightB, weightC } = seeds;

                if (!seedA && !seedB && !seedC) {
                    setError("Harap masukkan setidaknya satu konsep untuk dicampur.");
                    setGeneratedPrompt('');
                    return;
                }

                setIsLoading(true);
                setError(null);
                setGeneratedPrompt('');

                const finalSystemPrompt = getSystemPrompt(category, outputLanguage, detailLevel, visualWeight, technicalWeight);

                const stylePrefix = selectedStyles.length > 0 ? selectedStyles.map(key => {
                    const style = PREDEFINED_STYLES.find(s => s.key === key);
                    return style ? style.label : key; 
                }).join(', ') : '';

                let combinedSuffix = [stylePrefix, advancedSuffix.trim()]
                    .filter(item => item.trim() !== '') 
                    .join(', '); 
                
                let userQuery = `
                    Konsep utama untuk dicampur (Konsep : Bobot Prioritas (1-10)):
                    1. ${seedA || '[Kosong]'} : Bobot ${weightA}
                    2. ${seedB || '[Kosong]'} : Bobot ${weightB}
                    3. ${seedC || '[Kosong]'} : Bobot ${weightC}
                    
                    Gabungkan elemen-elemen ini, KEMBANGKAN LEBIH LANJUT konsep dengan bobot prioritas tertinggi, tambahkan detail artistik/teknis yang sesuai dengan kategori yang dipilih, dan buat menjadi prompt yang sangat deskriptif, kohesif, dan menginspirasi.
                `;
                
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: finalSystemPrompt }] },
                };

                try {
                    const result = await fetchWithRetry(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    let text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        const finalPromptWithSuffix = text + (combinedSuffix ? `. [Gaya/Teknis: ${combinedSuffix}]` : '');
                        
                        setGeneratedPrompt(finalPromptWithSuffix);
                        savePromptToHistory(finalPromptWithSuffix); 
                    } else {
                        setError("Gagal menghasilkan prompt. Periksa respons API.");
                        console.error("API Response Error:", result);
                    }
                } catch (err) {
                    setError(`Terjadi kesalahan jaringan atau server: ${err.message}`);
                } finally {
                    setIsLoading(false);
                    checkAdStatus(); 
                }
            };
            
            const handleGenerateClick = () => {
                if (isAdBlockActive) {
                    handleAdInteraction();
                } else {
                    handleMix();
                }
            };


            const buttonText = isAdLoading 
                ? "üé¨ Iklan Ditayangkan (Tunggu)..." 
                : isAdBlockActive 
                    ? "üì∫ Tonton Iklan (3s) & Hasilkan Prompt!" 
                    : "üöÄ Campur dan Hasilkan Prompt!";

            const buttonDisabled = isLoading || isAdLoading;

            const adStatusText = isAdBlockActive 
                ? 'Status: Anda perlu mengklik Iklan untuk melanjutkan Generasi.' 
                : `Status: Grace Period aktif! Generasi Bebas selama ${countdown} detik lagi.`;

            return (
                <div className="min-h-screen bg-gray-100 p-4 sm:p-8 font-sans">
                    <header className="max-w-4xl mx-auto mb-8 text-center">
                        <h1 className="text-4xl font-extrabold text-indigo-700">Prompt Mixer Kreatif üé®</h1>
                        <p className="text-lg text-gray-600 mt-2">
                            Gabungkan 3 ide unik Anda menjadi satu prompt AI yang detail dan memukau.
                        </p>
                    </header>

                    <main className="max-w-4xl mx-auto bg-white p-6 rounded-2xl shadow-xl">
                        
                        {/* Status Iklan DENGAN HITUNGAN MUNDUR */}
                        <div className={`p-3 mb-6 rounded-lg text-center font-semibold ${isAdBlockActive ? 'bg-red-100 text-red-700 border border-red-300' : 'bg-green-100 text-green-700 border border-green-300'}`}>
                            {adStatusText}
                        </div>

                        {/* Kategori, Bahasa, dan Tingkat Detail */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label htmlFor="prompt-category" className="block text-sm font-bold text-gray-700 mb-1">
                                    1. Kategori Output
                                </label>
                                <select
                                    id="prompt-category"
                                    value={category}
                                    onChange={(e) => setCategory(e.target.value)}
                                    className="w-full p-3 border-2 border-purple-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-150 shadow-md"
                                    disabled={buttonDisabled}
                                >
                                    {PROMPT_CATEGORIES.map(cat => (
                                        <option key={cat.key} value={cat.key}>
                                            {cat.label}
                                        </option>
                                    ))}
                                </select>
                                <p className="text-xs text-purple-600 mt-1 italic">{getCategoryDescription(category)}</p>
                            </div>

                            <div>
                                <label htmlFor="output-language" className="block text-sm font-bold text-gray-700 mb-1">
                                    2. Bahasa Output
                                </label>
                                <select
                                    id="output-language"
                                    value={outputLanguage}
                                    onChange={(e) => setOutputLanguage(e.target.value)}
                                    className="w-full p-3 border-2 border-purple-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-150 shadow-md"
                                    disabled={buttonDisabled}
                                >
                                    {OUTPUT_LANGUAGES.map(lang => (
                                        <option key={lang.key} value={lang.key}>
                                            {lang.label}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label htmlFor="detail-level" className="block text-sm font-bold text-gray-700 mb-1">
                                    3. Tingkat Detail
                                </label>
                                <select
                                    id="detail-level"
                                    value={detailLevel}
                                    onChange={(e) => setDetailLevel(e.target.value)}
                                    className="w-full p-3 border-2 border-purple-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-150 shadow-md"
                                    disabled={buttonDisabled}
                                >
                                    {DETAIL_LEVELS.map(level => (
                                        <option key={level.key} value={level.key}>
                                            {level.label}
                                        </option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        {/* Input Section */}
                        <div className="space-y-4 mb-6">
                            <div className="flex justify-between items-center border-b pb-2">
                                <h2 className="text-xl font-bold text-gray-700">4. Masukkan Konsep (Seed Ideas)</h2>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={handleRandomWeights}
                                        className="text-sm px-3 py-1 bg-purple-100 text-purple-700 font-semibold rounded-full hover:bg-purple-200 transition"
                                        disabled={buttonDisabled}
                                        title="Atur Bobot Secara Acak 1-10"
                                    >
                                        üéöÔ∏è Bobot Acak
                                    </button>
                                    <button
                                        onClick={handleFillExamples}
                                        className="text-sm px-3 py-1 bg-indigo-100 text-indigo-700 font-semibold rounded-full hover:bg-indigo-200 transition"
                                        disabled={buttonDisabled}
                                    >
                                        Isi Contoh
                                    </button>
                                </div>
                            </div>
                            
                            {/* Input A with Weight Slider */}
                            <div className="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg border border-indigo-100">
                                <input
                                    type="text"
                                    placeholder="Konsep A:"
                                    className="flex-grow p-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500 transition duration-150"
                                    value={seeds.seedA}
                                    onChange={(e) => handleSeedChange('seedA', e.target.value)}
                                    disabled={buttonDisabled}
                                />
                                <button
                                    onClick={() => handleRandomSeed('seedA')}
                                    className="p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-sm"
                                    title="Acak Konsep A"
                                    disabled={buttonDisabled}
                                >
                                    üé≤
                                </button>
                                <div className="flex flex-col items-center w-32 ml-4">
                                    <label className="text-xs font-bold text-indigo-700 whitespace-nowrap">Bobot: {seeds.weightA}/10</label>
                                    <input 
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={seeds.weightA}
                                        onChange={(e) => handleWeightChange('weightA', e.target.value)}
                                        className="w-full h-1 bg-indigo-300 rounded-lg appearance-none cursor-pointer range-sm"
                                        disabled={buttonDisabled}
                                    />
                                </div>
                            </div>
                            
                            {/* Input B with Weight Slider */}
                            <div className="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg border border-indigo-100">
                                <input
                                    type="text"
                                    placeholder="Konsep B:"
                                    className="flex-grow p-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500 transition duration-150"
                                    value={seeds.seedB}
                                    onChange={(e) => handleSeedChange('seedB', e.target.value)}
                                    disabled={buttonDisabled}
                                />
                                <button
                                    onClick={() => handleRandomSeed('seedB')}
                                    className="p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-sm"
                                    title="Acak Konsep B"
                                    disabled={buttonDisabled}
                                >
                                    üé≤
                                </button>
                                <div className="flex flex-col items-center w-32 ml-4">
                                    <label className="text-xs font-bold text-indigo-700 whitespace-nowrap">Bobot: {seeds.weightB}/10</label>
                                    <input 
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={seeds.weightB}
                                        onChange={(e) => handleWeightChange('weightB', e.target.value)}
                                        className="w-full h-1 bg-indigo-300 rounded-lg appearance-none cursor-pointer range-sm"
                                        disabled={buttonDisabled}
                                    />
                                </div>
                            </div>
                            
                            {/* Input C with Weight Slider */}
                            <div className="flex items-center space-x-2 bg-gray-50 p-3 rounded-lg border border-indigo-100">
                                <input
                                    type="text"
                                    placeholder="Konsep C:"
                                    className="flex-grow p-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500 transition duration-150"
                                    value={seeds.seedC}
                                    onChange={(e) => handleSeedChange('seedC', e.target.value)}
                                    disabled={buttonDisabled}
                                />
                                <button
                                    onClick={() => handleRandomSeed('seedC')}
                                    className="p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-sm"
                                    title="Acak Konsep C"
                                    disabled={buttonDisabled}
                                >
                                    üé≤
                                </button>
                                <div className="flex flex-col items-center w-32 ml-4">
                                    <label className="text-xs font-bold text-indigo-700 whitespace-nowrap">Bobot: {seeds.weightC}/10</label>
                                    <input 
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={seeds.weightC}
                                        onChange={(e) => handleWeightChange('weightC', e.target.value)}
                                        className="w-full h-1 bg-indigo-300 rounded-lg appearance-none cursor-pointer range-sm"
                                        disabled={buttonDisabled}
                                    />
                                </div>
                            </div>
                        </div>
                        
                        {/* Predefined Styles Section */}
                        <div className="mb-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
                            <h3 className="text-sm font-bold text-indigo-700 mb-3">5. Tambahkan Gaya Cepat (Quick Styles) - Otomatis Sesuai Kategori</h3>
                            <div className="flex flex-wrap gap-2">
                                {availableStyles.map(style => (
                                    <button
                                        key={style.key}
                                        onClick={() => toggleStyle(style.key)}
                                        className={`px-4 py-1 text-sm font-semibold rounded-full transition duration-150 shadow-sm
                                            ${selectedStyles.includes(style.key) 
                                                ? 'bg-indigo-600 text-white hover:bg-indigo-700' 
                                                : 'bg-white text-indigo-500 border border-indigo-300 hover:bg-indigo-50'
                                            }`}
                                        disabled={buttonDisabled}
                                    >
                                        {style.label} {selectedStyles.includes(style.key) ? '‚úî' : ''}
                                    </button>
                                ))}
                                {availableStyles.length === 0 && (
                                    <p className="text-sm text-indigo-500 italic">Tidak ada gaya cepat yang ditentukan untuk kategori ini.</p>
                                )}
                            </div>
                        </div>

                        {/* Advanced Suffix Input */}
                        <div className="mb-8 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <label htmlFor="advanced-suffix" className="block text-sm font-bold text-gray-600 mb-2">
                                6. Prompt Lanjutan (Opsional Suffix Manual)
                            </label>
                            <textarea
                                id="advanced-suffix"
                                placeholder="Tambahkan detail teknis di sini (misalnya: --ar 16:9, Python 3.10, negatif prompt: low quality, blurry)"
                                value={advancedSuffix}
                                onChange={(e) => setAdvancedSuffix(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-lg resize-none text-sm"
                                rows="2"
                                disabled={buttonDisabled}
                            />
                        </div>
                        
                        {/* Bobot Visual dan Teknis Global */}
                        <div className="mb-8 p-4 bg-purple-50 border border-purple-200 rounded-xl">
                            <h3 className="text-xl font-bold text-purple-700 mb-3">7. Prioritas Prompt Lanjutan (Suffix Weight)</h3>
                            <p className="text-sm text-purple-600 mb-4">Gunakan slider ini untuk menentukan seberapa kuat gaya dan parameter teknis yang Anda masukkan di bagian 5 & 6 harus mempengaruhi prompt akhir.</p>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {/* Bobot Visual */}
                                <div className="flex flex-col items-center p-3 bg-white rounded-lg shadow-inner">
                                    <label className="text-sm font-bold text-indigo-800 whitespace-nowrap mb-2">
                                        Bobot Estetika Visual: {visualWeight}/10
                                    </label>
                                    <input 
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={visualWeight}
                                        onChange={(e) => handleGlobalWeightChange(setVisualWeight, e.target.value)}
                                        className="w-full h-2 bg-pink-300 rounded-lg appearance-none cursor-pointer range-lg"
                                        disabled={buttonDisabled}
                                    />
                                    <p className="text-xs text-gray-500 mt-2">Memprioritaskan gaya, warna, pencahayaan, atau resolusi.</p>
                                </div>
                                
                                {/* Bobot Teknis */}
                                <div className="flex flex-col items-center p-3 bg-white rounded-lg shadow-inner">
                                    <label className="text-sm font-bold text-indigo-800 whitespace-nowrap mb-2">
                                        Bobot Parameter Teknis: {technicalWeight}/10
                                    </label>
                                    <input 
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={technicalWeight}
                                        onChange={(e) => handleGlobalWeightChange(setTechnicalWeight, e.target.value)}
                                        className="w-full h-2 bg-teal-300 rounded-lg appearance-none cursor-pointer range-lg"
                                        disabled={buttonDisabled}
                                    />
                                    <p className="text-xs text-gray-500 mt-2">Memprioritaskan rasio aspek, bahasa kode, atau instruksi negatif.</p>
                                </div>
                            </div>
                        </div>

                        {/* Control Button (Uses handleGenerateClick) */}
                        <button
                            onClick={handleGenerateClick}
                            className={`w-full py-4 text-xl font-bold rounded-xl shadow-lg transition duration-300 
                                ${buttonDisabled 
                                    ? 'bg-gray-400 cursor-not-allowed' 
                                    : isAdBlockActive
                                        ? 'bg-red-600 text-white hover:bg-red-700 active:bg-red-800 animate-pulse'
                                        : 'bg-green-500 text-white hover:bg-green-600 active:bg-green-700'
                                }`}
                            disabled={buttonDisabled}
                        >
                            {isLoading ? (
                                <span className="flex items-center justify-center">
                                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Mencampur Ide...
                                </span>
                            ) : (
                                buttonText
                            )}
                        </button>
                        
                        {/* Message Box for Alerts (for ad status and copy errors) */}
                        <div id="message-box" className="hidden mt-4 p-3 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded-lg text-center font-medium">
                            {/* Content populated by JS */}
                        </div>

                        {/* Error Display */}
                        {error && (
                            <div className="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                                <strong>Error:</strong> {error}
                            </div>
                        )}


                        {/* Output Section */}
                        <div className="mt-8">
                            <h2 className="text-xl font-bold text-gray-700 border-b pb-2 mb-4">Prompt Akhir yang Dihasilkan</h2>
                            
                            <div className="relative">
                                <textarea
                                    readOnly
                                    placeholder="Prompt hasil mixing akan muncul di sini..."
                                    value={generatedPrompt}
                                    className="w-full h-40 p-4 border-2 border-gray-300 rounded-lg bg-gray-50 resize-none text-gray-800"
                                />
                                
                                {generatedPrompt && (
                                    <button
                                        onClick={() => copyToClipboard()}
                                        className={`absolute top-2 right-2 p-2 text-sm rounded-full shadow-md transition duration-200 
                                            ${isCopied ? 'bg-green-500 text-white' : 'bg-indigo-500 text-white hover:bg-indigo-600'}`}
                                        title="Salin ke Clipboard"
                                    >
                                        {isCopied ? "‚úÖ Tersalin!" : "Salin"}
                                    </button>
                                )}
                            </div>
                            
                        </div>
                        
                        {/* --- RIWAYAT PROMPT (HISTORY) --- */}
                        {promptHistory.length > 0 && (
                            <div className="mt-10">
                                <h2 className="text-xl font-extrabold text-indigo-700 border-b pb-2 mb-4 flex justify-between items-center">
                                    Riwayat Prompt (10 Terbaru)
                                    <span className="text-sm font-medium text-gray-500">Total: {promptHistory.length}</span>
                                </h2>
                                <div className="space-y-3">
                                    {promptHistory.map((item) => (
                                        <div key={item.id} className="p-4 bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition duration-150">
                                            <div className="flex justify-between items-start mb-2">
                                                <div className="space-x-2 text-xs font-semibold">
                                                    <span className="bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">{item.category}</span>
                                                    <span className="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">{item.language}</span>
                                                </div>
                                                <span className="text-xs text-gray-400">{item.timestamp}</span>
                                            </div>
                                            <p className="text-sm text-gray-800 italic mb-3 line-clamp-2" title={item.prompt}>
                                                "{item.prompt}"
                                            </p>
                                            <div className="flex justify-end space-x-2">
                                                <button
                                                    onClick={() => copyToClipboard(item.prompt)}
                                                    className="px-3 py-1 text-xs font-semibold bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition"
                                                >
                                                    Salin
                                                </button>
                                                <button
                                                    onClick={() => deleteHistoryItem(item.id)}
                                                    className="px-3 py-1 text-xs font-semibold bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition"
                                                >
                                                    Hapus
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        // Render aplikasi ke elemen 'root'
        const rootElement = document.getElementById('root');
        ReactDOM.createRoot(rootElement).render(<App />);
    </script>
</body>
</html>
